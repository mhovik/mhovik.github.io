<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Scoping and the Module Pattern</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="../../site/reveal/css/reveal.css">
    <link rel="stylesheet" href="../../site/reveal/css/theme/white.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../site/reveal/lib/css/color-brewer.css">
    <link rel="stylesheet" href="../../site/reveal/css/154-override.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? '../../site/reveal/css/print/pdf.css' :
      '../../site/reveal/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
	</head>

	<body>
		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h1>CSE 154</h1>
					<h3>Scoping and the Module Pattern</h3>
        </section>

        <section>
          <h2>Scoping and the Module Pattern</h2>
          <p>When and where are variables defined?</p>
          <p>Why is it important to keep variables local?</p>
        </section>

        <section>
          <h2>Scoping</h2>
          <p>
            Remember that the scope of a variable is the region of a
            computer program where the variable name may be used.
          </p>
          <p>
            Recall that it is generally better, for software maintainabilty,
            to <strong>localize</strong> your variables, i.e. keep their scope
            as limited as possible to avoid "side effects" from other parts
            of the program.
          </p>
          <p>
            We've seen the keyword <code>let</code> used to declare a variable
            in the current scope (i.e. between {}'s of a function/loop/conditional statement).
          </p>

          <pre><code class="hijs" data-trim>function sayHello(name) {
  let output = "Hello " + name;  // output is local to sayHello
  console.log(output);
}
</code></pre>
          <p class="code-caption">JS</p>
        </section>

        <section>
          <h2>Example 1: Globals</h2>
          <p class="font-18pt">
            Globals are variables or functions that are visible throughout the
            entire program. They can be bad; other code and other JS files can
            see and modify them, sometimes unexpectedly!</p>
          <p class="medium-small-font">
            <a href="samplecode/js-example1/globalvariables.html">Example</a>:
            how many global variables/functions are introduced by this
             code? <span class="fragment">3 (<code>count</code>, <code>incr</code>,
               and <code>reset</code>)</span>
           </p>
            <pre><code class="hijs" data-trim>let count = 0;        // count is a global variable

function incr(n) {    // n is a parameter, local to function incr
  let diez = 10;      // diez is a local variable
  count += n;
}

function reset() {
  count = 0;          // because count is global it can be reset here
  // diez = 0;        // diez would not be able to be set here.
}

incr(4);
incr(2);
console.log(count);</code></pre>
            <p class="code-caption">JS</p>
        </section>

        <section>
          <h2>Example 2: Let Variables</h2>
          <p>
            <code>let</code> localizes the scope of a variable. Sometimes with interesting results.
            <a href="samplecode/js-example1/letvariables.js">Example</a>:

            <pre><code class="hijs" data-trim>let count = 0; // this count is a global variable

function incr(n) {
  let count  = 10;    // this count is a local to incr
  count += n;
}

incr(4);
incr(2);
console.log(count);</code></pre>
            <p class="code-caption">JS</p>
        </section>

        <section>
          <h2>Aside: don't use <code>var</code></h2>
          <p>We don't want you using var. Period. Even if you see others use it. <a
            href="samplecode/js-example1/varvariables.js" target="_blank">Example</a>:</p>
          <pre><code class="hijs" data-trim>function varTest() {
  console.log("varTest");
  var x = 1;
  if (x === 1) {
    var x = 2;          // same variable!
    console.log(x);     // 2
  }
  console.log(x);         // 2
}

function letTest() {
  console.log("letTest");
  let x = 1;
  if (x === 1) {
    let x = 2;          // different variable
    console.log(x);     // 2
  }
  console.log(x);         // 1
}
</code></pre>
          <p class="code-caption">JS</p>
        </section>

        <section>
          <h2>Containing globals in a function</h2>
          <p class="font-16pt">If we enclose the code all in one function, it
            encloses the scope of all of those symbols into that function.
          </p>
          <p class="font-16pt">
            Example: how many global symbols are introduced by this
             code? <span class="fragment"> only 1 (<code>everything</code>)</span><br>
            <span class="fragment">But can we get it to 0?</span>
          </p>
            <pre><code class="hljs font-14pt" data-trim>function everything() {
  let count = 0;

  function incr(n) {
    count += n;
  }

  function reset() {
    count = 0;
  }

  incr(4);
  incr(2);
  console.log(count);
}

everything(); // call the function to run the code</code></pre>
            <p class="code-caption">JS</p>
        </section>

        <section>
          <h2>Anonymous Functions</h2>
          <pre><code class="hljs" data-trim>function(parameters) {
  ... statements ...;
}</code></pre>

          <p>JavaScript allows you to declare <span class="term">anonymous functions</span></p>
          <p>Quickly creates a function without giving it a name</p>
          <p>Can be stored as a variable, attached as an event handler, etc.</p>
        </section>


        <section>
          <h2>The &quot;module pattern&quot;</h2>

          <pre><code class="hljs" data-escape data-trim>(function() {
  statements;
})();</code></pre>

          <p>Wraps all of your file's code in an anonymous function that is declared and immediately
          called</p>
          <p>0 global symbols will be introduced!</p>
          <p>The variables and functions defined by your code cannot be messed with externally</p>
        </section>

        <section>
          <h2>Module pattern example</h2>
          <p><a href="samplecode/js-example1/noglobalvariables.html"
                target="_blank">Example</a>: How many global symbols are introduced in this code?</p>
          <p class="fragment">0 global symbols!</p>
          <div class="example">
            <pre><code class="hljs" data-escape data-trim>(function() {
  let count = 0;

  function incr(n) {
      count += n;
  }

  function reset() {
      count = 0;
  }

  incr(4);
  incr(2);
  console.log(count);
})();</code></pre>
            <p class="code-caption">JS</p>
          </div>
        </section>

        <section>
          <h2>JavaScript "strict" mode</h2>

          <pre><code class="hljs" data-trim>"use strict";

...your code...
</code></pre>
          <p class="code-caption">JS</p>

          <p>
            Writing <code>"use strict";</code> at the very top of your JS file turns
            on strict syntax checking:
          </p>
          <ul>
            <li>Shows an error if you try to assign to an undeclared variable</li>
            <li>Stops you from overwriting key JS system libraries</li>
            <li>Forbids some unsafe or error-prone language features</li>
          </ul>
          <p>You should <em>always</em> turn on strict mode for your code in this class!</p>
        </section>

        <section>
          <h2>JavaScript File Skeleton</h2>

          <div class="code-example">
            <pre><code class="hljs" data-trim>/**
 * Name, section, date, etc.
 * Description of program
 */
(function() {
  "use strict";

  // phew! your code goes here

})();</code></pre>
            <p class="code-caption">JS</p>
          </div>
        </section>

        <section>
          <h2>Take Aways</h2>
          <ul>
            <li>Scoping is ... confusing</li>
            <li>You might not "get" it until you run into a bug, but until then don't
              overthink it</li>
            <li>Localize scope</li>
            <li>Use <code>let</code> vs <code>var</code></li>
            <li>Use the module pattern to elimiate global variables</li>
          </ul>
        </section>

  <script src="../../site/reveal/lib/js/head.min.js"></script>

  <script src="../../site/reveal/js/reveal.js"></script>
  <script src="lec08.js"></script>

  <script>
    Reveal.initialize({
      controls: true,
      progress: true,
      history: true,
      center: true,

      transition: 'slide', // none/fade/slide/convex/concave/zoom

      // More info https://github.com/hakimel/reveal.js#dependencies
      dependencies: [{
          src: '../../site/reveal/lib/js/classList.js',
          condition: function() {
            return !document.body.classList;
          }
        },
        {
          src: '../../site/reveal/plugin/markdown/marked.js',
          condition: function() {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: '../../site/reveal/plugin/markdown/markdown.js',
          condition: function() {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: '../../site/reveal/plugin/highlight/highlight.pack.js',
          async: true,
          callback: function() {
            hljs.initHighlightingOnLoad();
          }
        },
        { src: '../../site/reveal/plugin/zoom-js/zoom.js', async: true },
        { src: '../../site/reveal/plugin/notes/notes.js', async: true },
        { src: '../../site/reveal/plugin/search/search.js', async: true },
        { src: '../../site/reveal/plugin/print-pdf/printpdfbtn.js', async: true }
      ]
    });
  </script>
</body>
</html>
