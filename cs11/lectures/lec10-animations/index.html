<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Lecture 10: Timers and Asynchronous Programming</title>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="../../site/reveal/css/reveal.css">
    <link rel="stylesheet" href="../../site/reveal/css/theme/white.css" id="theme">

    <!-- Theme used for syntax highlighting of code -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="../../site/reveal/lib/css/color-brewer.css">
    <link rel="stylesheet" href="../../site/reveal/css/154-override.css">

    <!-- Printing and PDF exports -->
    <script>
      var link = document.createElement( 'link' );
      link.rel = 'stylesheet';
      link.type = 'text/css';
      link.href = window.location.search.match( /print-pdf/gi ) ? '../../site/reveal/css/print/pdf.css' :
      '../../site/reveal/css/print/paper.css';
      document.getElementsByTagName( 'head' )[0].appendChild( link );
    </script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>
	<body>
		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
        <section>
          <h2>Lecture 10</h2>
          <h3>Timers and Asynchronous Programming</h3>
        </section>

        <section>
          <h2>Administrivia</h2>
          <p>CP2 - Lock date tomorrow at 11PM - great work so far!</p>
          <p>HW2</p>
          <ul>
            <li>Review and implement Part A Feedback recieved yesterday</li>
            <li>Tester is out for Part B (more on next slide).</li>
            <li>Remember to review provided video</li>
            <li>You should have received an email about PSTutor and 2 "make up" points for HW2 - make sure to complete the survey and activities now, then submit the reflections on Friday for the 2 points.</li>
          </ul>
        </section>
        <section>
          <h2>Using Tester Part B</h2>
          <div class="side-by-side">

            <div>
        <a href="https://courses.cs.washington.edu/courses/cse154/19su/homework/" target="_blank"><img src="hidden/hw2-page.png" alt="Screenshot of HW2 Turnin" /></a>
        <p>Unzip <code>tester-partb.zip</code> inside of your <code>hw2-set-&ltusername&gt;</code> directory and follow the instructions
          on <code>index.html</code></p>
      </div>
        <img style="width: 35%;" src="hidden/tester-partb-screenshot.png" alt="Screenshot of HW2 Tester Part B Directory Structure" />
        </div>
      </section>
        <section>
          <h2>Agenda</h2>
          <p>Callbacks: What are JS functions really?</p>
          <p>Timers review</p>
        </section>

        <section>
          <h2>JavaScript... A Wild Ride.</h2>
          <p>Think back to your first programming language (for most of you, Java)</p>
          <p>Unlike an object-oriented language like Java, with JS we:</p>
          <ul>
            <li>Can listen to events like clicks</li>
            <li>Can access and change HTML/CSS with the DOM</li>
            <li>Don't have types (e.g. <code>let</code> vs. <code>int</code>)</li>
            <li>Have a (handy?) notion of truthy/falsy</li>
          </ul>
          <pre><code class="no-syntax-highlight">if (id("my-box")) { ... // true if exists on the page }</code></pre>
          <ul>
            <li>Can pass in functions as arguments???</li>
          </ul>
        </section>

        <section>
          <h2>So why is JS so different?</h2>
          <p>
            Java is often used to <em>build systems</em>.
          </p>
          <ul>
            <li>Objects are great to compose together to build complex systems.</li>
            <li>Systems must be reliable - a benefit of strict types, compiling, and well-defined behavior in Java.</li>
          </ul>
          <p>JavaScript is used to <em>interact</em> and <em>communicate</em>.</p>
          <ul>
            <li>It listens.</li>
            <li>It responds.</li>
            <li>It requests.</li>
          </ul>
        </section>

        <section>
          <h2>JS: Adding Interacitvity to Webpages</h2>
          <p>Your browsers runs JS to communicate with:</p>
          <ul>
            <li>Users: Interactions between events and the DOM</li>
            <pre><code>btn.addEventListener("click", sayHello);</code></pre>
            <li>Servers: Requesting and recieving data</li>
            <pre><code>fetch("https://api.nasa.gov").then(...)</code></pre>
          </ul>
          <p>
            Whereas in Java, programs often have a well-defind specification (behavior), JS has to
            deal with uncertainty (weird users, unavailable servers, no internet connection, etc.)
          </p>
        </section>

        <section>
          <h2>Asynchronous Programming</h2>
          <p>The JS programs we've been writing are naturally asynchronous</p>
          <p>We <em>pass</em> functions as arguments to other functions so that we can “call back later” once we know something we expect occurred.
          </p>
        </section>
        <section>
          <h2>You are a JS Developer.</h2>
          <p>
            Our goal is to assign tasks to events, and responsibly handle uncertainty.
          </p>
          <p>Luckily, we have a handy toolset of functions:</p>
          <ul>
            <li><code>addEventListener</code>, <code>setTimeout/setInterval</code>, <code>fetch</code>, etc.)</li>
          </ul>
          <p>and developer tools</p>
          <ul>
            <li>(the Chrome debugger is your best friend!)</li>
          </ul>
          <p>Remember - as a human, you already are skilled at dealing with uncertainty! Your task is just to teach JS how it needs to handle events.</p>

        </section>
        <section>
          <h3>We've already been writing asynchronously!</h3>
          <p>Our first example of handling "uncertain" behavior was <code>addEventListener("click", openBox)</code></p>
          <ul><li>Only when the click event occurs does the function execute.</li></ul>
          <p>On Friday, we introduced <code>setTimeout</code> and <code>setInterval</code>.</p>
          <ul>
            <li>Only when the delay has passed, does the function execute.</li>
          </ul>
          <p>Later this week, we will introduce <code>fetch</code> and Promises.</p>
          <ul>
            <li>Only after we receive a response after making a request to an API like NASA, does the function execute.</li>
          </ul>
        </section>

        <section>
          <h2>Looking More Closely at JS Functions</h2>
          <p>First-class function: Treated just like any other variable type</p>
          <p>Can store as variables, pass as arguments to functions, return as values from functions</p>
        </section>
        <section>
          <h2>Defining functions as variables</h2>
          <pre><code>function callbackFn(params) {
  ...
}

let callbackFn = function(params) {
  ...
};

let callbackFn = (params) => {
  ...
};</code></pre>
          <p class="code-caption">JS</p>
          <p>Regardless of how we create these, we use them the same way.</p>
          <pre><code>let result = callbackFn(params);</code></pre>
          <p class="code-caption">JS</p>
        </section>
        <section>
          <h2>Passing functions as arguments</h2>
          <pre><code>btn.addEventListener("click", callbackFn);
btn.addEventListener("click", function() {
  ...
});
btn.addEventListener("click", () => {
  ...
});
</code></pre>
<p class="code-caption">JS</p>

<pre><code>setTimeout(callbackFn, 2000);
setTimeout(function() {
  ...
}, 2000);
setTimeout(() => {
  ...
}, 2000);</code></pre>
<p class="code-caption">JS</p>
        </section>

        <section>
          <h2>An Example</h2>
          <p>A slight modification of the <a href="https://javascript.info/function-expressions-arrows#callback-functions" target="_blank">callback example</a> from the reading</p>
          <p>Is this a higher-order function?</p>
          <pre><code>function askQ(qText) {
  let answer = prompt(qText);
  if (answer === "yes") {
    console.log("You answered yes!");
  } else if (answer === "no") {
    console.log("You answered no!");
  } else {
    console.log("I have no idea what " + qText + " means.");
  }
}</code></pre>
        <p class="code-caption">JS</p>
        <p>Demo: <a href="code/callback-demo.html" target="_blank">(starter)</a></p>
        </section>

        <section>
          <h2>Another Example</h2>
          <p>Is this a higher-order function?</p>
          <div class="side-by-side">
            <div>
          <pre><code class="font-12pt">function askQ(qText, yesFn, noFn, handleError) {
  let answer = prompt(qText);
  if (answer === "yes") {
    yesFn();
  } else if (answer === "no") {
    noFn();
  } else {
    handleError(answer);
  }
}</code></pre>
<p class="code-caption">JS</p>
</div>
<div>
<pre><code class="font-12pt">function yesFn() {
  console.log("You answered yes!");
}

function noFn() {
  console.log("You answered no!");
}

function handleError(answer) {
  console.log("I have no idea what " +
              answer + " means.");
}</code></pre>
<p class="code-caption">JS</p>
</div>
</div>
        </section>
        <section>
          <h2>Passing different functions</h2>
          <div class="side-by-side">
            <div>
          <pre><code class="font-12pt">function askQ(qText, yesFn, noFn, handleError) {
  let answer = prompt(qText);
  if (answer === "yes") {
    // yesFn();
    yesFn2();
  } else if (answer === "no") {
    // noFn();
    noFn2();
  } else {
    handleError(answer);
  }
}</code></pre>
<p class="code-caption">JS</p>
</div>
<div>
<pre><code class="font-12pt">function yesFn2() {
  id("output").textContent = "You answered yes!";
}

function noFn() {
  id("output").textContent = "You answered no!";
}

function handleError(answer) {
  console.log("I have no idea what " + answer + " means. Try again");
  processQuestion();
}</code></pre>
<p class="code-caption">JS</p>
</div>
</div>
        </section>
        <section>
          <h2>Pre-Check Q2</h2>
          <p>
            Callbacks are a very powerful feature in event-driven programming.
          </p>
          <p>
            Why do you think it's useful to have the ability in the JavaScript language to pass callback
            functions as arguments to other functions like <code>addEventListener</code> and <code>setTimeout</code> in JS?<p>
          </p>
        </section>

        <section>
          <h2>Back to Timers</h2>
          <p>Used to delay or set intervals for executing functions</p>
        </section>
        <section>
          <h2>Pre-Check Q4</h2>
          <pre><code>(function() {
  console.log("Foo 1");
  window.addEventListener("load", init);

  function init() {
    setTimeout(testFunction, 1000);
    console.log("Foo 2");
  }

  function testFunction() {
    console.log("Foo 3");
  }

  console.log("Foo 4");
})();</code></pre>
<p class="code-caption">precheck-q4.js</p>
<p><a href="code/precheck-q4.html" target="_blank">Running demo</a></p>
        </section>

        <section>
					<h2>Setting a Timer</h2>
          <table class="code-table">
            <tr>
              <th>method</th>
              <th>description</th>
            </tr>
            <tr>
              <td>setTimeout(responseFn, delayMS)</td>
              <td>Arranges to call given function after given delayMS, returns timer id</td>
            </tr>
            <tr>
              <td>setInterval(responseFn, delayMS)</td>
              <td>Arranges to call function <strong>repeatedly</strong> every delayMS ms, returns timer id</td>
            </tr>
            <tr>
              <td>
                clearTimeout(timerID)
                <br />
                clearInterval(timerID)
              </td>
              <td>Stops the given timer</td>
            </tr>
          </table>
          <div class="font-18pt">
          <p>
            Both <code>setTimeout</code> and <code>setInterval</code> return an ID
            representing the timer
          </p>
          <p>
            This id is used as a "key" to tell the window to stop the specific timer.
          </p>
          </div>
          <p>Practice: <a href="../lec09-js-timers/examples/timers-practice.html" target="_blank">timers-practice.html</a></p>
        </section>
        <section>
          <h2><code>setTimeout</code> Example</h2>
          <pre><code class="hljs" data-trim>&lt;button id="demo-btn">Click me!&lt;/button>
&lt;span id="output-text">&lt;/span>
</code></pre>
          <p class="code-caption">HTML</p>

          <pre><code class="hljs" data-trim>function init() {
  id("demo-btn").addEventListener("click", delayedMessage);
}

function delayedMessage() {
  id("output-text").textContent = "Wait for it...";
  setTimeout(sayHello, 500);
}

function sayHello() { // called when the timer goes off
  id("output-text").textContent = "Hello!";
}</code></pre>
          <p class="code-caption">JS</p>

          <div class="output">
            <button id="demo-btn">Click me!</button>
            <span id="output-text"></span>
            <p class="output-caption">output (<a href="../lec09-js-timers/examples/settimeout-example.html"
                                                 target="_blank">full example page</a>)</p>
          <div>
      </section>

         <section>
          <h2><code>setInterval</code> Example</h2>
          <pre><code class="hljs" data-trim>&lt;button id="demo-btn"&gt;Click me!&lt;/button&gt;
&lt;span id="output-text"&gt;&lt;/span&gt;
</code></pre>
          <p class="code-caption">HTML</p>
          <pre><code class="hljs" data-trim>let timerId = null; // stores ID of interval timer
function repeatedMessage() {
  timerId = setInterval(sayHello, 1000);
}

function sayHello() {
  id("output-text").textContent += "Hello!";
}</code></pre>
          <p class="code-caption">JS</p>
          <div class="output">
            <button id="demo-btn2">Click me!</button>
            <span id="output-text2"></span>
            <p class="output-caption">output (<a href="../lec09-js-timers/examples/setinterval-example.html"
                                                 target="_blank">full example page</a>)</p>
          </div>
        </section>
        <section>
          <h2>"Toggling" Animation with <code>clearInterval</code></h2>
          <pre><code>&lt;button id="toggle-btn"&gt;Start/Stop&lt;button&gt;
</code></pre>
          <p class="code-caption">HTML</p>
          <pre class="font-14pt"><code class="hljs " data-trim>let timerId = null; // stores ID of interval timer
function init() {
  id("toggle-btn").addEventListener("click", toggleMessageInterval);
}

// 1. What does this function do?
function toggleMessageInterval() {
  if (timerId === null) {
    timerId = setInterval(sayHello, 1000);
  } else {
    clearInterval(timerId);
    timerId = null; // 2. Why is this line important?
    // 3. What happens if you swap the two lines above?
  }
}

function sayHello() {
  id("output-text").textContent += "Hello!";
}</code></pre>
          <p class="code-caption">JS</p>
          <div class="output">
            <button id="demo-btn-toggle">Start/Stop</button>
            <span id="output-text-toggle"></span>
            <p class="output-caption">output (<a href="../lec09-js-timers/examples/toggle-interval.html"
                                                 target="_blank">full example page</a>)</p>
          <div>
        </section>

        <section>
          <h2>Questions To Think About</h2>
          <ol>
          <li>When do you need to keep track of a timer id?</li>
          <li>Can you think of a scenario where you would want to keep track of more than one timer
            id?</li>
          </ol>
        </section>
        <section>
          <h2>A Typing Simulator!</h2>
          <p>Starter code: <a href="code/typing-simulator-starter.html" target="_blank">typing-simulator-starter.html</a></p>
          <p>Running solution: <a href="code/typing-simulator.html" target="_blank">typing-simulator.html</a></p>
          <p>What other features can you think to add? A dropdown with speed? Multiple timers?</p>
        </section>
        <section>
          <h2>Summary</h2>
          <p>
          When you want to call a function after a specified delay in time, use
          <code>setTimeout</code>.
          </p>
          <p>
            When you want to call a function <em>repeatedly</em> every X seconds, use
            <code>setInterval</code> (though <a
             href="https://javascript.info/settimeout-setinterval#recursive-settimeout"
             target="_blank">you can also</a> use <code>setTimeout</code> recursively!)</p>
          </p>
          <p>
            For both types of timers, you'll need a variable with the timer id (returned
            by both functions) to pass to <code>clearTimeout</code>/<code>clearInterval</code> when
            you want to stop the delay/interval.
          </p>
        </section>
			</div>
		</div>
  <script src="../../site/reveal/lib/js/head.min.js"></script>
  <script src="../../site/reveal/js/reveal.js"></script>
  <script src="timer-slides.js"></script>

  <script>
    Reveal.initialize({
      controls: true,
      progress: true,
      history: true,
      center: true,

      transition: 'slide', // none/fade/slide/convex/concave/zoom

      // More info https://github.com/hakimel/reveal.js#dependencies
      dependencies: [{
          src: '../../site/reveal/lib/js/classList.js',
          condition: function() {
            return !document.body.classList;
          }
        },
        {
          src: '../../site/reveal/plugin/markdown/marked.js',
          condition: function() {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: '../../site/reveal/plugin/markdown/markdown.js',
          condition: function() {
            return !!document.querySelector('[data-markdown]');
          }
        },
        {
          src: '../../site/reveal/plugin/highlight/highlight.pack.js',
          async: true,
          callback: function() {
            hljs.initHighlightingOnLoad();
          }
        },
        { src: '../../site/reveal/plugin/zoom-js/zoom.js', async: true },
        { src: '../../site/reveal/plugin/notes/notes.js', async: true },
        { src: '../../site/reveal/plugin/search/search.js', async: true },
        { src: '../../site/reveal/plugin/print-pdf/printpdfbtn.js', async: true }
      ]
    });
  </script>
</body>
</html>
